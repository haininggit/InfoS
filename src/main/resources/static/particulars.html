<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title> åŠ¨æ€è¯¦æƒ… </title>
    <link rel="stylesheet" href="css/particulars.css" type="text/css">
    <link rel = "stylesheet" href = "./css/main.css">
    <link rel="shortcut icon" href="./images/logo.png">

</head>
<body>
<!--å¯¼èˆªæ¡-->
<nav class="mainNav" style="z-index: 9">
    <div class="logo">

    </div>
    <div class="functions">
        <textarea class="search" placeholder="å¤§å®¶æ­£åœ¨æœ:çœŸç›¸å¥¶èŒ¶"></textarea><img src="images/search.png" alt=""
                                                                          onclick="search()">
        <ul>
            <li><a href="person02.html">æˆ‘è¦å†™èµ°æµ‹è¯•</a></li>
            <li><a href="home.html">é¦–é¡µ</a></li>
            <li><a href="video.html">è§†é¢‘</a></li>
            <li><a href="mynote.html">å…³æ³¨</a></li>
            <li><a href="chatroom.html" onclick="function f() {
                document.getElementById('notices').innerText=0;
              document.getElementById('notices').style.display='none';
            }">èŠå¤©</a></li>
        </ul>
    </div>
    <div class="setting">
        <ul>
            <li class="setting-message">
                <!-- ä¸‹æ‹‰å°ä¸‰è§’ -->
                æ¶ˆæ¯<p id="notices" style="display: none">0</p>
                <div class="setting-wrapper">
                    <!-- <div class="triangle"></div> -->
                    <ul class="drop-down-message">
                        <li><a href="javascript:;">@æˆ‘çš„</a></li>
                        <li><a href="javascript:;">è¯„è®º</a></li>
                        <li><a href="javascript:;">èµ</a></li>
                        <li><a href="javascript:;">ç§ä¿¡</a></li>
                        <li><a href="javascript:;">æœªå…³æ³¨äººç§ä¿¡</a></li>
                        <li><a href="javascript:;">ç¾¤é€šçŸ¥</a></li>
                        <li class="last-mes"><a href="javascript:;">æ¶ˆæ¯è®¾ç½®</a></li>
                    </ul>
                </div>
            </li>
            <li class="message-setting">
                è®¾ç½®
                <div class="message-wrapper">
                    <ul class="drop-down-setting">
                        <li><a href="javascript:;">è´¦å·è®¾ç½®</a></li>
                        <li><a href="javascript:;">ä¼šå‘˜ä¸­å¿ƒ</a></li>
                        <li><a href="javascript:;">Vè®¤è¯</a></li>
                        <li><a href="javascript:;">è´¦å·å®‰å…¨</a></li>
                        <li><a href="javascript:;">éšç§è®¾ç½®</a></li>
                        <li><a href="javascript:;">å±è”½è®¾ç½®</a></li>
                        <li><a href="javascript:;">æ¶ˆæ¯è®¾ç½®</a></li>
                        <li><a href="javascript:;">å¸®åŠ©ä¸­å¿ƒ</a></li>
                        <li><a href="javascript:;" class="out">é€€å‡º</a></li>
                    </ul>
                </div>
            </li>
            <li>å…¶ä»–</li>
        </ul>
    </div>
</nav>
<!--å†…å®¹å¤§æ¡†æ¶-->
<div class="content">

    <div class="main">
        <!--åŠ¨æ€éƒ¨åˆ† å·¦-->
        <div class="thing" id="thing">


            <div class="butt">

                <li><a href="#">æ”¶è—</a></li>
                <li><a href="#">è½¬å‘</a></li>
                <li><a href="#">è¯„è®º</a></li><!--onclick="f()"-->
                <!--<script  >-->
                <!--function f() {-->
                <!--// alert("å¼¹å‡ºè¯„è®ºæ¡†");< img src="../images/head.png" >-->
                <!--document.getElementById("com").innerHTML=-->
                <!--"<img src='images/1.png' style='margin-left: 20px;margin-top: 10px;width: 40px;height: 40px;float: left'>" +-->
                <!--"<textarea name='com' style='margin-top: 5px;margin-left: 5px; width: 500px;height: 100px; line-height: 150%;padding: 10px'></textarea>"-->
                <!--+"<button onclick='f1()' style='margin: 5px;background-color: #eb7350;color: white;padding:3px 15px;'>è¯„è®º</button>";-->


                <!--}-->
                <!--function f1() {-->
                <!--document.getElementById("hf").innerHTML=-->

                <!--"<div class=\"comment\">" +-->
                <!--"<img src='images/1.png' style='margin-left: 20px;margin-top: 10px;width: 40px;height: 40px;float: left'>" +-->
                <!--"<p>dasdadsadasd</p>"-->
                <!--+"<button onclick='com()' style='margin: 5px;background-color: #eb7350;color: white;padding:3px 15px;'>è¯„è®º</button>"-->
                <!--+"</div>";-->


                <!--}-->
                <!--</script>-->
                <li><a href="#">ç‚¹èµ</a></li>

            </div>

            <!--è¯„è®ºéƒ¨åˆ†-->

            <div id="com">
                <ul id="pn">
                    <li class="list0">

                        <div class="content">
                            <div class="comment-list" id="comment-list">

                                <!--                                <div class="comment" user="self">-->
                                <!--                                    <div class="comment-right">-->
                                <!--                                        <div class="comment-text"><span class="user">æˆ‘ï¼š</span>çœ‹å“­äº†ç•™å¡å·å§</div>-->
                                <!--                                        <div class="comment-date">-->
                                <!--                                            <br>-->
                                <!--                                            02-14 24:00-->
                                <!--                                            <a class="comment-zan" href="javascript:;" total="0" my="0">èµ</a>-->
                                <!--                                            <a class="comment-dele" href="javascript:;">åˆ é™¤</a>-->
                                <!--                                        </div>-->
                                <!--                                    </div>-->
                                <!--                                </div>-->
                            </div>
                            <div class="hf">
                                <textarea type="text" id="text" class="hf-text" autocomplete="off" maxlength="100"
                                          placeholder="è¯„è®º..." onblur="textOnblur(this)" name="root"
                                          onfocus=" textGetFocus(this)"> </textarea>
                                <button class="hf-btn" onclick="send(this)">è¯„è®º</button>
                                <span class="hf-nub">0/100</span>
                            </div>
                        </div>
                    </li>

                </ul>
                <script type="text/javascript">
                    function textOnblur(obj) {
                        //
                        // if(obj.innerText.length==0){
                        //     // console.log("change className....")
                        //     obj.parentNode.className='hf';
                        //     obj.value ='è¯„è®ºâ€¦';
                        // }

                    }

                    function textGetFocus(obj) {
                        // console.log(obj.parentNode)
                        obj.parentNode.className = 'hf hf-on';
                        obj.value = obj.value == 'è¯„è®ºâ€¦' ? '' : obj.value;
                    }

                </script>
            </div>

        </div>
        <!--è¯¥åšä¸»ä¿¡æ¯  å³-->
        <div class="self">
            <a id="but3" href="#">Infos è®¤è¯ </a>
            <p style="font-size: 15px">æ˜µç§° </p>
            <br/>
            <p>ğŸšª è¡Œä¸šç±»åˆ« ä¼˜ç§€åšä¸» ç¼–è¾‘ </p>
            <p>ğŸ‘‰ ç®€ä»‹ï¼š å¥½å¥½å­¦ä¹  ä¸ç†¬å¤œ</p>
            <br/>
            <a style="text-align: center; cursor: pointer;" href="#"> æ›´å¤š ï¼</a>
        </div>
    </div>

    <!--åº•éƒ¨-->
    <div class="foot">
        <p>Infos å®¢æœ å®¢æœçƒ­çº¿ 8888-8888</p>

        <p>æ„è§åé¦ˆ å¼€æ”¾å¹³å° å•†åŠ¡åˆä½œ</p>
        <p>Copyright@2020-2020 Infos å¼€å‘å°ç»„</p>
    </div>
</div>
<script src="js/jquery.min.js"></script>
<script src="js/jquery.cookie.js"></script>
<script>
    /**
     * å¹³è®ºåŠŸèƒ½ï¼›
     *
     */
    var comment_replyId;
    var comment_user;
    var messageId = $.cookie("messageId")
    var userName = $.cookie("userName");
    onload = function () {
        // console.log("hello,world")

        // console.log(messageId)
        $.ajax({
            url: "message/getMessage",
            type: "POST",
            data: {messageId: messageId},
            success: function (data) {


                var user = data.data.user;
                var message = data.data.message;
                var commens = data.data.comments;

                var message1 = document.createElement("div");
                message1.className = "message";
                message1.innerHTML = " <div class=\"head\">\n" +
                    "                    <img src='" + user.userImg + "' class=\"round_icon\">\n" +
                    "                </div>\n" +
                    "                <div class=\"msg\">\n" +
                    "                    <div class=\"name\">\n" +
                    "\n" +
                    "                        <a id=\"but1\">" + user.userName + "</a>\n" +
                    "\n" +
                    "                        <a id=\"but2\">â• å…³æ³¨</a>\n" +
                    "                    </div>\n" +
                    "\n" +
                    "                    <div class=\"sub\">\n" +

                    "                       " + message.message.messageInfo + " <div id=\"mediaList\" style=\"width: 100%;height: 400px;display: block;float: left;background-color:red;\"></div>\n" +
                    "\n" +
                    "\n" +
                    "                    </div>\n" +
                    "                </div>"

                // console.log(message1)
                document.getElementById("thing").prepend(message1)

                // console.log(commens);
                for (var i = 0; i < commens.length; i++) {
                    var comment = document.createElement("div");
                    comment.className = "comment"
                    comment.user = "self";
                    comment.innerHTML = " <div class=\"comment-right\" id='" + commens[i].comment.commentId + "'>\n" +
                        "                                        <div class=\"comment-text\"><span class=\"user\">" + commens[i].userName + ":</span>" + commens[i].comment.commentInfo + "</div>\n" +
                        "                                        <div class=\"comment-date\">\n" +
                        "                                            <br>\n" +
                        "                                            " + commens[i].comment.commentTime + "" +
                        "                                            <a class=\"comment-dele\" href=\"javascript:;\" onclick='reply(this)'>å›å¤</a>\n" +
                        "                                        </div>\n" +
                        "                                    </div>"
                    document.getElementById("comment-list").append(comment);

                }

            }
        })
    }

    function send(obj) {


        var textinput = obj.parentNode.children[0];
        var userId = $.cookie("userId");
        var commentInfo = textinput.value;
        var sendType = textinput.getAttribute("name");
        // console.log(sendType + ":sendtype")
        if (sendType == "root") {
            // console.log("root:....................")
            // console.log(userId);
            // console.log(messageId);
            // console.log(commentInfo);
            // console.log("....................")
            $.ajax({
                url: "comment/addComment",
                type: "post",
                data: {
                    userId: userId,
                    messageId: messageId,
                    commentInfo: commentInfo
                },
                dataType: "JSON",
                success: function (data) {
                    // console.log(data);
                    /**
                     * data:{
                     *     userName,commentId,commentTime
                     * }
                     * @type {string}
                     *
                     *
                     */

                    var div_comment = document.createElement("div");
                    div_comment.className = "comment"
                    div_comment.user = "self";
                    div_comment.innerHTML = "<div class=\"comment-right\" id='" + data.data.commentId + "'>\n" +
                        "                                        <div class=\"comment-text\"><span class=\"user\">" + userName + ":</span>" + commentInfo + "</div>\n" +
                        "                                        <div class=\"comment-date\">\n" +
                        "                                            <br>\n" +
                        "                                            " + data.data.commentTime + "" +
                        "                                            <a class=\"comment-dele\" href=\"javascript:;\" onclick='reply(this)'>å›å¤</a>\n" +
                        "                                        </div>\n" +
                        "                                    </div>"


                    document.getElementById("comment-list").append(div_comment);

                }

            })
        } else if (sendType == "son") {
            var replyInfo = $("#text").val();
            // console.log("userId:" + userId + "\ncomment_replyId:" + comment_replyId + "\nreplyInfo:" + replyInfo + "...........................")
            $.ajax({
                url: "reply/saveReply",
                type: "POST",
                data: {
                    userId: userId,
                    parentId: comment_replyId,
                    replyInfo: replyInfo,
                },
                success: function (data) {

                    if (comment_user.indexOf(':') > 0) {
                        comment_user = comment_user.substr(0, comment_user.indexOf(':'))
                    }

                    // console.log("comment_user:"+comment_user)
                    var reply = data.data;
                    // console.log(data)
                    var comment = "<div class=\"comment\" user=\"self\">\n" +
                        "                                    <div class=\"comment-right\" id='" + reply.replyId + "'>\n" +
                        "                                        <div class=\"comment-text\"><span class=\"user\">" + userName + ":@å›å¤" + comment_user + "</span>" + ':' + replyInfo + "</div>\n" +
                        "                                        <div class=\"comment-date\">\n" +
                        "                                            <br>\n" +
                        "                                           " + reply.replyTime + "\n" +
                        "                                            <a class=\"comment-dele\" href=\"javascript:;\" onclick='reply(this)'>å›å¤</a>\n" +
                        "                                        </div>\n" +
                        "                                    </div>\n" +
                        "                                </div>";


                    /**
                     * å°†ç”Ÿæˆçš„commentè¿½åŠ åˆ° document.getElementById(comment_replyId)ä¹‹å
                     */
                    $(comment).insertAfter($(document.getElementById(comment_replyId)));
                    document.getElementById("text").setAttribute("name", "root");
                    document.getElementById("text").innerText = "";


                },
                error: function (data) {
                    console.log(data)

                }
            })

        }


        // console.log("change className....")
        document.getElementById("text").parentNode.className = 'hf';
        document.getElementById("text").value = 'è¯„è®ºâ€¦';


    }

    function reply(obj) {

        obj.onclick=null;
        document.getElementById("text").parentNode.className = 'hf hf-on';
        document.getElementById("text").value = document.getElementById("text").value == 'è¯„è®ºâ€¦' ? '' : document.getElementById("text").value;
        document.getElementById("text").focus()
        comment_replyId = obj.parentNode.parentNode.id;

        // console.log("comment_replyId:" + comment_replyId)
        comment_user = obj.parentNode.parentNode.children[0].children[0].innerText;
        // comment_user = comment_user.substr(0, comment_user.indexOf(":"))

        $.ajax({
                url: "reply/getReplysById",
                data: {parentId: comment_replyId},
                type: "POST",
                success: function (data) {
                    // console.log(data)
                    var reples = data.data;
                    if (reples != "æ²¡æœ‰æ•°æ®") {
                        for (var i = 0; i < reples.length; i++) {
                            var reply = reples[i];
                            var comment = "<div class=\"comment\" user=\"self\">\n" +
                                "                                    <div class=\"comment-right\"  id='" + reply.reply.replyId + "' >\n" +
                                "                                        <div class=\"comment-text\"><span class=\"user\">" + reply.userName + ":@å›å¤" + reply.byUserName + "</span>" + ':' + reply.reply.replyInfo + "</div>\n" +
                                "                                        <div class=\"comment-date\">\n" +
                                "                                            <br>\n" +
                                "                                           " + reply.reply.replyTime + "\n" +
                                "                                            <a class=\"comment-dele\" href=\"javascript:;\" onclick='reply(this)'>å›å¤</a>\n" +
                                "                                        </div>\n" +
                                "                                    </div>\n" +
                                "                                </div>";


                            /**
                             * å°†ç”Ÿæˆçš„commentè¿½åŠ åˆ° document.getElementById(comment_replyId)ä¹‹å
                             */
                            $(comment).insertAfter($(document.getElementById(comment_replyId).parentNode));
                        }
                    }


                },
            }
        );


        var text = document.getElementById("text");
        text.setAttribute("name", "son");
        text.focus();

    }

    function guanzhu(userId) {

    }

</script>
</body>
</html>