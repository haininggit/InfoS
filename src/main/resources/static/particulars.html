<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title> åŠ¨æ€è¯¦æƒ… </title>
    <link rel="stylesheet" href="css/particulars.css" type="text/css">
</head>
<body>
<!--å¯¼èˆªæ¡-->
<nav class="mainNav">
    <div class="logo">

    </div>
    <div class="functions">
        <textarea class="search" placeholder="å¤§å®¶æ­£åœ¨æœ:çœŸç›¸å¥¶èŒ¶"></textarea><img src="images/search.png" alt="">
        <ul>
            <li><a href="">æˆ‘è¦å†™èµ°æµ‹è¯•</a></li>
            <li><a href="">é¦–é¡µ</a></li>
            <li><a href="">è§†é¢‘</a></li>
            <li><a href="">å‘ç°</a></li>
            <li><a href="">æ¸¸æˆ</a></li>
        </ul>
    </div>
    <div class="setting">
        <ul>
            <li class="setting-message">
                <!-- ä¸‹æ‹‰å°ä¸‰è§’ -->
                æ¶ˆæ¯
                <div class="setting-wrapper">
                    <!-- <div class="triangle"></div> -->
                    <ul class="drop-down-message">
                        <li><a href="javascript:;">@æˆ‘çš„</a></li>
                        <li><a href="javascript:;">è¯„è®º</a></li>
                        <li><a href="javascript:;">èµ</a></li>
                        <li><a href="javascript:;">ç§ä¿¡</a></li>
                        <li><a href="javascript:;">æœªå…³æ³¨äººç§ä¿¡</a></li>
                        <li><a href="javascript:;">ç¾¤é€šçŸ¥</a></li>
                        <li class="last-mes"><a href="javascript:;">æ¶ˆæ¯è®¾ç½®</a></li>
                    </ul>
                </div>
            </li>
            <li class="message-setting">
                è®¾ç½®
                <div class="message-wrapper">
                    <ul class="drop-down-setting">
                        <li><a href="javascript:;">è´¦å·è®¾ç½®</a></li>
                        <li><a href="javascript:;">ä¼šå‘˜ä¸­å¿ƒ</a></li>
                        <li><a href="javascript:;">Vè®¤è¯</a></li>
                        <li><a href="javascript:;">è´¦å·å®‰å…¨</a></li>
                        <li><a href="javascript:;">éšç§è®¾ç½®</a></li>
                        <li><a href="javascript:;">å±è”½è®¾ç½®</a></li>
                        <li><a href="javascript:;">æ¶ˆæ¯è®¾ç½®</a></li>
                        <li><a href="javascript:;">å¸®åŠ©ä¸­å¿ƒ</a></li>
                        <li><a href="javascript:;" class="out">é€€å‡º</a></li>
                    </ul>
                </div>
            </li>
            <li>å…¶ä»–</li>
        </ul>
    </div>
</nav>
<!--å†…å®¹å¤§æ¡†æ¶-->
<div class="content">

    <div class="main">
        <!--åŠ¨æ€éƒ¨åˆ† å·¦-->
        <div class="thing" id="thing">

            <!--            <div class="message">-->
            <!--                <div class="head">-->
            <!--                    <img src="images/head.png" class="round_icon">-->
            <!--                </div>-->
            <!--                <div class="msg">-->
            <!--                    <div class="name">-->
            <!--                        <a id="but1">æ˜µç§° V</a>-->
            <!--                        <a id="but2">â•å…³æ³¨</a>-->
            <!--                    </div>-->
            <!--                    <div class="sub">-->
            <!--                            hello,word-->
            <!--                    </div>-->
            <!--                </div>-->
            <!--            </div>-->

            <div class="butt">

                <li><a href="#">æ”¶è—</a></li>
                <li><a href="#">è½¬å‘</a></li>
                <li><a href="#">è¯„è®º</a></li><!--onclick="f()"-->
                <li><a href="#">ç‚¹èµ</a></li>
            </div>

            <!--è¯„è®ºéƒ¨åˆ†-->

            <div id="com">
                <ul id="pn">
                    <li class="list0">

                        <div class="content">
                            <div class="comment-list" id="comment-list">
                                <!--                                                                <div class="comment" user="self">-->
                                <!--                                                                    <div class="comment-right">-->
                                <!--                                                                        <div class="comment-text"><span class="user">è€ç‹ï¼š</span>æˆ‘ä½éš”å£æˆ‘å§“ç‹</div>-->
                                <!--                                                                        <div class="comment-date">-->
                                <!--                                                                            <br>-->
                                <!--                                                                            02-14 22:00-->
                                <!--                                                                            <a class="comment-zan" href="javascript:;" total="23" my="1">23 å–æ¶ˆèµ</a>-->
                                <!--                                                                            <a class="comment-dele" href="javascript:;">å›å¤</a>-->
                                <!--                                                                        </div>-->
                                <!--                                                                    </div>-->
                                <!--                                                                </div>-->

                                <!--                                                                <div class="comment" user="self">-->
                                <!--                                                                    <div class="comment-right">-->
                                <!--                                                                        <div class="comment-text"><span class="user">æˆ‘ï¼š</span>çœ‹å“­äº†ç•™å¡å·å§</div>-->
                                <!--                                                                        <div class="comment-date">-->
                                <!--                                                                            <br>-->
                                <!--                                                                            02-14 24:00-->
                                <!--                                                                            <a class="comment-zan" href="javascript:;" total="0" my="0">èµ</a>-->
                                <!--                                                                            <a class="comment-dele" href="javascript:;">åˆ é™¤</a>-->
                                <!--                                                                        </div>-->
                                <!--                                                                    </div>-->
                                <!--                                                                </div>-->
                            </div>
                            <div class="hf">
                                <textarea type="text" id="text" class="hf-text" autocomplete="off" maxlength="100"
                                          placeholder="è¯„è®º..." name="root">
                                </textarea>
                                <button class="hf-btn" onclick="send(this)">è¯„è®º</button>
                                <span class="hf-nub">0/100</span>
                            </div>
                        </div>
                    </li>

                </ul>

            </div>

        </div>
        <!--è¯¥åšä¸»ä¿¡æ¯  å³-->
        <div class="self">
            <a id="but3" href="#">Infos è®¤è¯ </a>
            <p style="font-size: 15px">æ˜µç§° </p>
            <br/>
            <p>ğŸšª è¡Œä¸šç±»åˆ« ä¼˜ç§€åšä¸» ç¼–è¾‘ </p>
            <p>ğŸ‘‰ ç®€ä»‹ï¼š å¥½å¥½å­¦ä¹  ä¸ç†¬å¤œ</p>
            <br/>
            <a style="text-align: center; cursor: pointer;" href="#"> æ›´å¤š ï¼</a>
        </div>
    </div>

    <!--åº•éƒ¨-->
    <div class="foot">
        <p>Infos å®¢æœ å®¢æœçƒ­çº¿ 8888-8888</p>

        <p>æ„è§åé¦ˆ å¼€æ”¾å¹³å° å•†åŠ¡åˆä½œ</p>
        <p>Copyright@2020-2020 Infos å¼€å‘å°ç»„</p>
    </div>
</div>
<script src="js/jquery1111.min.js"></script>
<script src="js/jquery.cookie.js"></script>
<script>
    /**
     * å¹³è®ºåŠŸèƒ½ï¼›
     *
     */
    var comment_replyId;
    var comment_user;
    var messageId = $.cookie("messageId")
    var userName = $.cookie("userName");
    onload = function () {
        $.ajax({
            url: "message/getMessageById",
            type: "POST",
            data: {messageId: messageId},
            success: function (data) {
                var user = data.user;
                var message = data.message;
                var commens = data.comments;

                var message = "   <div class=\"message\">\n" +
                    "                <div class=\"head\" id='" + user.userId + "'>\n" +
                    "                    <img src='" + user.userImg + "' class=\"round_icon\">\n" +
                    "                </div>\n" +
                    "                <div class=\"msg\">\n" +
                    "                    <div class=\"name\">\n" +
                    "                        <a id=\"but1\">" + user.userName + "</a>\n" +
                    "                        <a id=\"but2\" onclick='guanzhu(" + user.userId + ")'>â• å…³æ³¨</a>\n" +
                    "                    </div>\n" +
                    "                    <div class=\"sub\">\n" + message.messageInfo +

                    "                    </div>\n" +
                    "                    \n" +
                    "                </div>\n" +
                    "            </div>"

                $("#thing").appendChild(message);

                for (var i = 0; i < commens.length; i++) {
                    var comment = "    <div class=\"comment\" user=\"self\">\n" +
                        "                                    <div class=\"comment-right\" id='" + commens[i].comment.commentId + "'>\n" +
                        "                                        <div class=\"comment-text\"><span class=\"user\">" + commens[i].comment.userName + "ï¼š</span>" + commens[i].comment.commentInfo + "</div>\n" +
                        "                                        <div class=\"comment-date\">\n" +
                        "                                            <br>\n" +
                        "                                           " + commens[i].comment.commentTime + "\n" +
                        "                                            <a class=\"comment-dele\" href=\"javascript:;\" onclick='reply(this)'>å›å¤</a>\n" +
                        "                                        </div>\n" +
                        "                                    </div>\n" +
                        "                                </div>"

                    $("#comment-list").appendChild(comment);

                }

            }
        })
    }

    function send(obj) {

        var textinput = obj.parentNode.children[0];
        var userId = $.cookie("userId");
        var commentInfo = textinput.value;
        var sendType = textinput.getAttributeNode("name")
        if (sendType == "root") {
            $.ajax({
                url: "comment/save",
                type: "post",
                data: {
                    userId: userId,
                    messageId: messageId,
                    commentInfo: commentInfo
                },
                dataType: "JSON",
                success: function (data) {
                    /**
                     * data:{
                     *     userName,commentId,commentTime
                     * }
                     * @type {string}
                     */
                    var comment = "<div class=\"comment\" user=\"self\">\n" +
                        "                                    <div class=\"comment-right\" id='" + data.data.commentId + "'>\n" +
                        "                                        <div class=\"comment-text\"><span class=\"user\">" + userName + "ï¼š</span>" + data.data.commentInfo + "</div>\n" +
                        "                                        <div class=\"comment-date\">\n" +
                        "                                            <br>\n" +
                        "                                           " + data.data.commentTime + "\n" +
                        "                                            <a class=\"comment-dele\" href=\"javascript:;\" onclick='reply(this)'>å›å¤</a>\n" +
                        "                                        </div>\n" +
                        "                                    </div>\n" +
                        "                                </div>"
                    $("#comment-list").appendChild(comment);

                }

            })
        } else if (sendType == "son") {
            var replyInfo = $("#text").val();
            $.ajax({
                url: "reply/saveReply",
                type: "POST",
                data: {
                    replyUserId: userId,
                    commentId: comment_replyId,
                    replyInfo: replyInfo,
                },
                success: function (data) {
                    var reply = data.data.reply;
                    var comment = "<div class=\"comment\" user=\"self\">\n" +
                        "                                    <div class=\"comment-right\" id='" + reply.replyId + "'>\n" +
                        "                                        <div class=\"comment-text\"><span class=\"user\">" + userName + ":@å›å¤" + comment_user + "</span>" + ':' + replyInfo + "</div>\n" +
                        "                                        <div class=\"comment-date\">\n" +
                        "                                            <br>\n" +
                        "                                           " + reply.replyTime + "\n" +
                        "                                            <a class=\"comment-dele\" href=\"javascript:;\" onclick='reply(this)'>å›å¤</a>\n" +
                        "                                        </div>\n" +
                        "                                    </div>\n" +
                        "                                </div>";


                    /**
                     * å°†ç”Ÿæˆçš„commentè¿½åŠ åˆ° document.getElementById(comment_replyId)ä¹‹å
                     */
                    $(comment).insertAfter($(document.getElementById(comment_replyId)));
                    document.getElementById("text").setAttribute("name", "root");
                    document.getElementById("text").innerText = "";


                }
            })

        }
    }

    function reply(obj) {


        comment_replyId = obj.parentNode.parentNode.id;
        comment_user = obj.parentNode.parentNode.children[0].children[0].innerText;
        comment_user = comment_user.substr(0, comment_user.indexOf(":"))

        $.ajax({
            url: "getReplysById",
            data: {replyId: comment_replyId},
            type: "POST",
            success: function (data) {
                var reples = data.data;

                // for (var i = 0; i < reples.length; i++) {
                //     var reply = reples[i];
                //
                //     var comment = "<div class=\"comment\" user=\"self\">\n" +
                //         "                                    <div class=\"comment-right\" id='" + reply.replyId + "'>\n" +
                //         "                                        <div class=\"comment-text\"><span class=\"user\">" + userName + ":@å›å¤" + comment_user + "</span>" + ':' + replyInfo + "</div>\n" +
                //         "                                        <div class=\"comment-date\">\n" +
                //         "                                            <br>\n" +
                //         "                                           " + reply.replyTime + "\n" +
                //         "                                            <a class=\"comment-dele\" href=\"javascript:;\" onclick='reply(this)'>å›å¤</a>\n" +
                //         "                                        </div>\n" +
                //         "                                    </div>\n" +
                //         "                                </div>";
                //
                //
                //     /**
                //      * å°†ç”Ÿæˆçš„commentè¿½åŠ åˆ° document.getElementById(comment_replyId)ä¹‹å
                //      */
                //     $(comment).insertAfter($(document.getElementById(comment_replyId)));
                }
            }

        })


        var text = document.getElementById("text");
        text.setAttribute("name", "son");
        text.focus();

    }

    function guanzhu(userId) {

    }

</script>

</body>
</html>